<metal:html>
  <metal:body use-macro="here/main_template/macros/master">
    <metal:head fill-slot="head_slot">
      <style type="text/css" media="all"
       tal:content="string: @import url(${base_url}cpsskins_theme_edit.css);" />
      <script type="text/javascript" src="cpsskins_pdlib.js"></script>
      <script type="text/javascript" src="cpsskins_portalbox_edit.js"></script>
    </metal:head>
    <metal:header fill-slot="header"
    tal:define="global context_urlc python:here.getContextUrl(utool=utool, concat=1)">
      <tal:security condition="python:not checkPerm('Manage Boxes', here)">
        <tal:redirect define="response request/RESPONSE; dummy python:response.redirect(context_url)" />
      </tal:security>
      <div class="documentActions">
        <a href="box_create_form" i18n:translate="button_create_box"
          tal:attributes="href string:${context_urlc}/box_create_form">Add a box</a>
      </div>
      <h2 i18n:translate="heading_box_manage_form">Boxes
      management</h2>
      <p i18n:translate="">description_visible_box_from
      <span i18n:name="context_url"
      tal:content="context_url" /></p>
    </metal:header>
    <metal:main fill-slot="main">
      <tal:block define="tmtool here/portal_themes">
        <tal:block repeat="block python: tmtool.getPageBlocks(theme=current_theme)">
          <table cellpadding="0" cellspacing="3" width="100%">
            <tr valign="top"
            tal:define="objects python: block.getObjects();
                        maxcols block/maxcols|nothing">
              <tal:block condition="maxcols"
              repeat="x_pos python: range(int(maxcols))">
                <tal:block define="objects_in_xpos python: objects.get(x_pos, None);
                                   contents_in_xpos python: objects_in_xpos['contents'];
                                   cellsize python: objects_in_xpos['cellsizer'];
                                   cellwidth cellsize/cellwidth|nothing"
                           condition="contents_in_xpos">
                  <td tal:attributes="width cellwidth">
                    <tal:block repeat="content contents_in_xpos">
                      <div tal:content="content/title"
                      class="templetBox"
                      tal:condition="content/aq_explicit/isPortalBox|nothing" />
                      <tal:block condition="content/aq_explicit/isMainContent|nothing"
                        define="default string:vertical;
                                orientation content/orientation|default">
                        <div class="boxGroupBoundingBox"
                          tal:define="group string:center">
                          <div i18n:translate=""
                          tal:content="string:label_center"
                          class="boxGroupBoxSlotTitle" />
                          <tal:block define="sboxes python:btool.getBoxes(here, include_only_in_subfolder=1);
                                             sboxes python:btool.filterBoxes(sboxes, slot='center', keep_closed=1)">
                            <metal:block use-macro="here/cpsskins_box_manage_lib/macros/box_slot" />
                            <metal:block use-macro="here/cpsskins_box_manage_lib/macros/empty_slot" />
                          </tal:block>
                        </div>
                        <div class="boxGroupBoundingBox"
                          tal:define="group string:folder_view">
                          <div i18n:translate=""
                          tal:content="string:label_folder_view"
                          class="boxGroupBoxSlotTitle" />
                          <tal:block define="sboxes python:btool.getBoxes(here, include_only_in_subfolder=1);
                                             sboxes python:btool.filterBoxes(sboxes, slot='folder_view', keep_closed=1)">
                            <metal:block use-macro="here/cpsskins_box_manage_lib/macros/box_slot" />
                            <metal:block use-macro="here/cpsskins_box_manage_lib/macros/empty_slot" />
                          </tal:block>
                        </div>
                      </tal:block>
                      <tal:block condition="content/aq_explicit/isPortalBoxGroup|nothing"
                                 define="group content/box_group|nothing;
                                         default string:vertical;
                                         orientation content/orientation|default">
                        <div class="boxGroupBoundingBox" tal:condition="python: group != 'closed'">
                          <div i18n:translate=""
                          tal:content="string:label_${group}"
                          class="boxGroupBoxSlotTitle" />
                          <tal:block define="sboxes python:btool.getBoxes(here, include_only_in_subfolder=1);
                                             sboxes python:btool.filterBoxes(sboxes, slot=group, keep_closed=1)">
                            <metal:block use-macro="here/cpsskins_box_manage_lib/macros/box_slot" />
                            <metal:block use-macro="here/cpsskins_box_manage_lib/macros/empty_slot" />
                          </tal:block>
                        </div>
                      </tal:block>
                    </tal:block>
                  </td>
                </tal:block>
              </tal:block>
            </tr>
          </table>
        </tal:block>

        <h3 i18n:translate="heading_unused_boxes" i18n:domain="cpsskins">Unused boxes</h3>
        <p i18n:translate="description_unused_boxes" i18n:domain="cpsskins">Unused boxes</p>
        <tal:block define="hidden_slots python: here.cpsskins_listHiddenSlots(theme=current_theme)"
               condition="hidden_slots">
        <p style="text-align: right">
        <a
           i18n:translate="description_delete_unused_boxes"
           i18n:domain="cpsskins" 
           tal:attributes="href string:${context_urlc}/cpsskins_delete_unused_boxes?theme=$current_theme;
                          onclick python:'return window.confirm(\'%s\')' % (cpsmcat('description_confirm_delete'), )" >Delete unused box</a>
        </p>
        <table cellpadding="0" cellspacing="3">
          <tr>
             <td valign="top" tal:repeat="hidden_slot hidden_slots">
                <div class="boxGroupBoundingBox"
                  tal:define="group hidden_slot">
                  <div i18n:translate=""
                       tal:content="string:label_${hidden_slot}"
                       class="boxGroupBoxSlotTitleHidden">
                  </div>
                  <tal:block define="sboxes python:btool.getBoxes(here, include_only_in_subfolder=1);
                                 sboxes python:btool.filterBoxes(sboxes, slot=hidden_slot, keep_closed=1)">
                    <tal:block repeat="box sboxes">
                      <metal:block use-macro="here/cpsskins_box_manage_lib/macros/box" />
                    </tal:block>
                    <metal:block use-macro="here/cpsskins_box_manage_lib/macros/empty_slot" />
                  </tal:block>
                </div>
             </td>
          </tr>
        </table>
        </tal:block>
      </tal:block>
    <metal:block use-macro="here/cpsskins_box_manage_lib/macros/contextual_menu" />

    <!-- Begin pdlib footer -->
    <div id="drag-feedback-box"></div>
      <script type="text/javascript"><!--
      pd_setupPage();
      // --></script>
    <!-- End pdlib footer -->

    </metal:main>
  </metal:body>
</metal:html>
