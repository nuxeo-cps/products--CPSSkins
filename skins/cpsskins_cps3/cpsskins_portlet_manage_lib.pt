<metal:block define-macro="box">
  <div class="BoxGroupBoxSlot PortletBoxDrag"
   tal:define="ypos portlet/getOrder;
               portlet_url portlet/getURL;
               fti portlet/getTypeInfo;
               portlet_title fti/title_or_id;
               portlet_icon fti/getIcon"
   tal:attributes="portlet_rurl portlet/getRelativeUrl;
                   src_ypos python: ypos and ypos or 0;
                   src_slot group">
    <div class="PortletBoxDest" 
      tal:attributes="dest_slot group;
                      dest_ypos python: ypos and ypos or 0">
      <div class="BoxGroupBoxTitle">
        <a href=""
        tal:attributes="href string:${portlet_url}/cpsportlet_edit_form">
          <img border="0" width="12" height="12"
          tal:attributes="src string:${portal_url}/cpsskins_images/img_edit.png" />
        </a>
      </div>
      <div class="BoxGroupBoxBody PortletBoxEditMenu"
       tal:attributes="src_ypos python: ypos and ypos or 0;
                     src_slot group">
        <img width="16" height="16" 
         tal:condition="portlet_icon"
         tal:attributes="src string:${portal_url}/$portlet_icon" />
        <strong tal:content="structure python: cpsmcat(portlet_title)" />
      </div>
    </div>
  </div>
</metal:block>

<metal:block define-macro="contextual_menu" i18n:domain="cpsskins"
  tal:define="portal_url here/portal_url;
              ttool here/portal_types;
              ptltool nocall:here/portal_cpsportlets">
  <div id="choice-context-menu" class="context-menu">
    <div class="context-menu-header" class="context-menu">
      <tal:block i18n:translate="menu_insert_portlet" i18n:domain="cpsskins">
      Insert a portlet here</tal:block>
    </div>
    <tal:block repeat="ptype_id ptltool/listPortletTypes">
      <div class="context-menu-item"
      filter="pd_selected_item"
      tal:attributes="onmouseup string:Choice_insert('${ptype_id}')"
      tal:define="fti python: ttool.getTypeInfo(ptype_id);
                  portlet_icon python: fti.getIcon();
                  portlet_title python: fti and fti.title_or_id() or ptype_id">
        <img width="16" height="16" 
         tal:condition="portlet_icon"
         tal:attributes="src string:${portal_url}/$portlet_icon" />
        <tal:block content="structure python: cpsmcat(portlet_title)" />
      </div>
    </tal:block>
  </div>
</metal:block>

<metal:block define-macro="empty_slot">
  <div class="PortletBoxDest" style="margin:4px"
   tal:condition="python:len(portlets) == 0"
   tal:attributes="dest_slot group; 
   dest_ypos python: 0">
    <div class="PortletBoxEditMenu" style="padding: 20px"
     tal:attributes="src_ypos python: 0;
                     src_slot group">&nbsp;</div>
  </div>
</metal:block>

<metal:block define-macro="box_slot">
    <tal:block repeat="portlet portlets">
      <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/box" />
    </tal:block>
</metal:block>
