<html metal:define-macro="edit"
tal:define="global editing python: 1;
            tmtool here/portal_themes; 
            utool nocall:here/portal_url;
            base_url python: here.cpsskins_getBaseUrl();
            here_url python: base_url + utool.getRelativeUrl(here);
            mcat here/cpsskins_getlocalizer;
            cpsskins_mcat python: here.cpsskins_getlocalizer(cat='cpsskins');
            view_mode tmtool/getViewMode;
            global edit_mode view_mode/edit_mode|string:wysiwyg; 
            global theme view_mode/theme|nothing;
            global current_theme python: tmtool.getRequestedThemeName(context=here);
            global theme_container python: tmtool.getEffectiveThemeContainer(theme=current_theme);
            display_url_simulation python: edit_mode != 'layout';
            theme_container_url python: base_url + utool.getRelativeUrl(theme_container);
	    pagemargin theme_container/margin|nothing;
	    bodycolor theme_container/color|nothing;
            scrollx view_mode/scrollx|python:0;
            scrolly view_mode/scrolly|python:0">
  <head>
    <style type="text/css" media="all"
    tal:content="string: @import url(${base_url}cpsskins_theme_edit.css);" />
    <metal:block
    use-macro="here/cpsskins_main_template_edit/macros/head" />
    <script type="text/javascript" src="cpsskins_pdlib.js"></script>
    <script type="text/javascript" src="cpsskins_content_edit.js"></script>
    <script type="text/javascript" src="cpsskins_theme_edit.js"></script>
  </head>

  <body
   tal:attributes="class string:color${bodycolor};
                   onload string:javascript:scrollToCoordinates(${scrollx},${scrolly})">

   <div class="floatingHeader">
     <metal:block
      use-macro="here/cpsskins_theme_widgets/macros/navigate" />
     
     <metal:block 
      use-macro="here/cpsskins_theme_widgets/macros/simulate_hierarchy" />
     <metal:block
      use-macro="here/cpsskins_theme_widgets/macros/content_add_panel" />
   </div>

   <div class="editSpace">
    <metal:block
    use-macro="here/main_template/macros/master">
      <div
        tal:define="isPortalStyle here/aq_explicit/isPortalStyle|nothing;
                    isPortalPalette here/aq_explicit/isPortalPalette|nothing;
                    isPortalTheme here/aq_explicit/isPortalTheme|nothing;
                    isPortletBox here/aq_explicit/isPortletBox|nothing;
                    isImageBox here/aq_explicit/isImageBox|nothing;
                    isFlashBox here/aq_explicit/isFlashBox|nothing;
                    showPreview python: isPortalStyle or isPortalPalette;">
        <metal:block define-slot="edit" />
      </div>

      <metal:block fill-slot="cell_top" tal:define="ypos python: 0">
      </metal:block>


      <metal:block fill-slot="page_footer">
        <tal:block condition="layout_edit_mode">
          <metal:block
          use-macro="here/cpsskins_theme_widgets/macros/add_pageblock" />
        </tal:block>
        <!-- Begin pdlib footer -->
        <div id="drag-feedback-box"></div>
          <script type="text/javascript"><!-- 
          pd_setupPage();
          // --></script>
        <!-- End pdlib footer -->
      </metal:block>
    </metal:block>
   </div>
  </body>
</html>
