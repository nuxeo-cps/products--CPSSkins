<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<metal:block use-macro="here/cpsskins_edit_macro/macros/edit" i18n:domain="cpsskins">
  <metal:block fill-slot="edit"
  tal:define="current_style request/form/current_style|nothing;
              pss modules/Products/PythonScripts/standard; 
              stylecat request/form/style|nothing;
              mtool here/portal_membership;
              checkPerm nocall:mtool/checkPermission">
    <tal:block condition="python: not checkPerm('Manage Themes', here)"> 
      <tal:block define="dummy request/RESPONSE/unauthorized" />
    </tal:block>
    <metal:block use-macro="here/cpsskins_form_widgets/macros/stylenavigation" />
    <tal:block condition="not:stylecat">
      <h1 tal:define="title string:_Edit styles_"
      tal:content="python: mcat and mcat(title) or title"
      i18n:translate="" />
      <table cellpadding="3" cellspacing="0" border="0" summary="">
        <tal:block repeat="obj tmtool/listStyleTypes">
          <tal:block define="stylecat obj/getId">
            <tr>
              <td valign="top">
                <img tal:attributes="src string:${base_url}${obj/getIcon}" 
                 alt="*" width="16" height="16" />
              </td>
              <td>
                <a tal:define="stylecat_quoted python: pss.url_quote_plus(stylecat);
                               title python:'_%s_' % stylecat"
                   tal:attributes="href string:${here_url}/cpsskins_edit_styles?style=$stylecat_quoted"
                   i18n:translate="" style="text-decoration: none"
                   tal:content="python: mcat and mcat(title) or title" />
                <p tal:define="title obj/description"
                i18n:translate=""
                tal:content="python: mcat and mcat(title) or title" />
              </td>
            </tr>
          </tal:block>
        </tal:block>
      </table>
    </tal:block>
    <tal:block condition="stylecat"
    define="styles python: tmtool.findStylesFor(stylecat, here); 
            style_list styles/object|nothing">
      <h1 tal:define="title python:'_%s_' % stylecat" 
      tal:content="python: mcat and mcat(title) or title"
      i18n:translate="" />
      <tal:block repeat="style style_list">
        <div tal:define="style_title style/title;
                         style_url style/absolute_url;
                         parents style/findParents"
             tal:attributes="class python: current_style and style_title == current_style and 'EditPreviewSelected' or 'EditPreview'">
          <tal:block define="info style/getInfo; del_action info/delete|nothing; edit_action info/edit|nothing;">
            <a title="Delete" 
            tal:condition="del_action/can_delete|nothing"
            tal:define="msg string:_Deleting this style, are you sure?_;
                        msg python: cpsskins_mcat and cpsskins_mcat(msg) or msg;
                        onclick_msg python:'return window.confirm(\'%s\')' % msg"
            tal:attributes="onclick onclick_msg;
                            href string:${del_action/url}?goto=referer" >
              <img border="0" width="12" height="12"
              tal:attributes="src string:${base_url}cpsskins_images/img_style_delete.png" />
            </a>
            &nbsp;<a class="StyleTitle" tal:attributes="href string:${style_url}/edit_form?style=$stylecat">
              <tal:block content="style_title" />
            </a>
            <em tal:condition="style/aq_explicit/isDefaultStyle|nothing" i18n:translate=""
             style="float:right; padding-right:1em"
             tal:define="title string:_(default style)_"
             tal:content="python: mcat and mcat(title) or title" />
            <a tal:condition="not:style/aq_explicit/isDefaultStyle|nothing"
             tal:attributes="href string:${style_url}/cpsskins_setdefaultstyle">
              <em i18n:translate=""
               style="float:right; padding-right:1em"
               tal:define="title string:_set as default style_"
               tal:content="python: mcat and mcat(title) or title" />
            </a>
            <tal:block content="structure python: style.preview()" />
            <p tal:condition="python: len(parents) > 0">
              <span tal:define="title string:_This style is used by:_"
               tal:content="python: mcat and mcat(title) or title"
               i18n:translate="" />
              <span tal:repeat="parent parents">
                <img src="" tal:attributes="src string:${base_url}${parent/getIcon}"
                 align="middle" alt="" width="16" height="16" />
                <a href="" tal:attributes="href string:${parent/absolute_url}/edit_form?cat=style"
                 tal:content="parent/title_or_id" />&nbsp;&nbsp;
              </span>
            </p>
          </tal:block>
        </div>
      </tal:block>
      <form action="cpsskins_style_add" method="get">
        <input type="hidden" name="type_name" value=""
        tal:attributes="value stylecat" />
        <input type="image" type="submit" width="46" height="18"
        tal:attributes="src string:${base_url}cpsskins_images/img_addstyle.png" />
      </form>
    </tal:block>
  </metal:block>
</metal:block>
