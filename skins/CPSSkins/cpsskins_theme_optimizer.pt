<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<metal:block use-macro="here/cpsskins_edit_macro/macros/edit" i18n:domain="cpsskins">
  <metal:block fill-slot="edit"
  tal:define="tmtool here/portal_themes; 
              current_theme request/form/theme|nothing; 
              portal_url here/portal_url;
              theme_container python: tmtool.getThemeContainer(theme=current_theme); 
              unused_styles theme_container/findOrphanedStyles|nothing; 
              identical_styles theme_container/findIdenticalStyles|nothing; 
              invisible_templets theme_container/getInvisibleTemplets|nothing; 
              uncached_templets theme_container/findUncachedTemplets|nothing;
              i18n_templets theme_container/getI18nTemplets|nothing;
              optimized python: not (unused_styles or invisible_templets or uncached_templets or identical_styles or i18n_templets)">
    <h1 tal:define="title string:_Theme optimizer_"
    tal:content="python: mcat and mcat(title) or title"
    i18n:translate="" />
    <tal:block condition="not:optimized">
      <form action="" method="post"
      tal:attributes="action string:$portal_url/cpsskins_theme_optimize">
        <input type="hidden" name="theme"
        tal:attributes="value current_theme" />
        <input type="hidden" name="edit_mode"
        tal:attributes="value edit_mode" />
        <tal:block tal:condition="unused_styles">
          <h3 tal:define="title string:_Styles_"
          tal:content="python: mcat and mcat(title) or title"
          i18n:translate="" />
          <p tal:define="title string:_These styles are not used and can be deleted:_"
             tal:content="python: mcat and mcat(title) or title"
             i18n:translate="" />
          <table border="0" cellpadding="2" cellspacing="0"
          class="TableFrame" width="100%">
            <tal:block repeat="style unused_styles">
              <tr>
                <td width="50%">
                  <a tal:attributes="href string:${style/absolute_url}/edit_form?theme=$current_theme&edit_mode=$edit_mode">
                    <img tal:attributes="src string:$portal_url/${style/getIcon}" />
                    <span tal:content="style/getTitle" />
                  </a>
                </td>
                <td width="25%">
                  <span tal:define="title python:'_%s_' % style.meta_type"
                   tal:content="python: mcat and mcat(title) or title"
                   i18n:translate="" />
                </td>
                <td width="25%" align="right">
                  <tal:block define="title string:_Delete style?_"
                     content="python: mcat and mcat(title) or title" 
                     i18n:translate="" />
                  <input type="checkbox" name="delete_styles:list"
                  value="." checked="checked"
                  tal:attributes="value style/getId" />
                </td>
              </tr>
            </tal:block>
          </table>
        </tal:block>
        <tal:block condition="identical_styles"
        define="style_types python: identical_styles.keys()">
          <p tal:define="title string:_These styles are identical and can be merged together:_"
             tal:content="python: mcat and mcat(title) or title"
             i18n:translate="" />
          <tal:block repeat="style_type style_types">
            <tal:block define="styles_by_type python: identical_styles[style_type]">

              <tal:block repeat="blocks styles_by_type">
                <table border="0" cellpadding="2" cellspacing="0"
                class="TableFrame" width="100%">
                  <tr class="TableHeader"
                  tal:condition="styles_by_type">
                    <td colspan="2">
                      <span tal:define="title python:'_%s_' % style_type"
                       tal:content="python: mcat and mcat(title) or title"
                       i18n:translate="" />
                    </td>
                  </tr>
                  <tal:block repeat="style blocks">
                    <tr>
                      <td>
                        <a tal:attributes="href string:${style/absolute_url}/edit_form?theme=$current_theme&edit_mode=$edit_mode">

                          <img tal:attributes="src string:$portal_url/${style/getIcon}" />
                          <span tal:content="style/getTitle" />
                        </a>
                      </td>
                      <td align="right">
                        <tal:block define="title string:_Merge this style?_"
                         content="python: mcat and mcat(title) or title"
                         i18n:translate="" />
                        <input type="checkbox" name="" value="."
                        checked="checked"
                        tal:attributes="value style/getId; name string:merge_styles_${repeat/style_type/number}${repeat/blocks/number}" />
                      </td>
                    </tr>
                  </tal:block>
                </table>
              </tal:block>
            </tal:block>
          </tal:block>
        </tal:block>

        <tal:block condition="i18n_templets">
          <h3 tal:define="title string:_Translations_"
           tal:content="python: mcat and mcat(title) or title"
          i18n:translate="" />
          <p tal:define="title string:_Only select items that are supposed to get translated:_"
             tal:content="python: mcat and mcat(title) or title"
             i18n:translate=""  />
          <table border="0" cellpadding="5" cellspacing="0"
          class="TableFrame" width="100%">
            <tr tal:repeat="templet i18n_templets">
              <td width="30%">
                <a tal:attributes="href string:${templet/absolute_url}/edit_form?theme=$current_theme&edit_mode=$edit_mode">
                  <img tal:attributes="src string:$portal_url/${templet/getIcon}" />
                  <tal:block content="templet/getTitle" />
                </a>
              </td>
              <td width="70%" align="right">
                <table cellpadding="0" cellspacing="0">
                  <tr tal:repeat="prop_id templet/getI18nProperties">
                    <td align="right">
                      <tal:block define="label python: [p['label'] for p in templet.propertyMap() if p['id'] == prop_id];
                                         title python: label and'_%s_' % label[0] or prop_id"
                         condition="python: getattr(templet, prop_id)">
                        <span tal:content="python: mcat and mcat(title) or title" 
                         i18n:translate="" /> 
                        <input type="checkbox"
                         checked="checked"
                         name="items_to_translate:list" value="."
                         tal:attributes="value string:${templet/getId}:$prop_id">
                      </tal:block>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </tal:block>

        <tal:block condition="invisible_templets">
          <h3 tal:define="title string:_Templets_"
           tal:content="python: mcat and mcat(title) or title"
          i18n:translate="" />
          <p tal:define="title string:_These Templets are invisible and can be deleted:_"
             tal:content="python: mcat and mcat(title) or title"
             i18n:translate=""  />
          <table border="0" cellpadding="2" cellspacing="0"
          class="TableFrame" width="100%">
            <tal:block repeat="templet invisible_templets">
              <tr>
                <td width="50%">
                  <a tal:attributes="href string:${templet/absolute_url}/edit_form?theme=$current_theme&edit_mode=$edit_mode">
                    <img tal:attributes="src string:$portal_url/${templet/getIcon}" />
                    <tal:block content="templet/getTitle" />
                  </a>
                </td>
                <td width="50%" align="right">
                  <tal:block define="title string:_Delete Templet?_"
                   content="python: mcat and mcat(title) or title" 
                   i18n:translate="" /> 
                  <input type="checkbox"
                  name="delete_templets:list" value="."
                  checked="checked"     
                  tal:attributes="value templet/getId" />
                </td>                   
              </tr>                     
            </tal:block>
          </table>     
        </tal:block>


        <tal:block condition="uncached_templets">
          <h3 tal:define="title string:_Templets_"
           tal:content="python: mcat and mcat(title) or title"
          i18n:translate="" />
          <p tal:define="title string:_These Templets could be cached in memory for faster rendering:_"
             tal:content="python: mcat and mcat(title) or title"
             i18n:translate=""  />
          <table border="0" cellpadding="2" cellspacing="0"
          class="TableFrame" width="100%">
            <tal:block repeat="templet uncached_templets">
              <tr>
                <td width="50%">
                  <a tal:attributes="href string:${templet/absolute_url}/edit_form?theme=$current_theme&edit_mode=$edit_mode&cat=general">
                    <img tal:attributes="src string:$portal_url/${templet/getIcon}" />
                    <tal:block content="templet/getTitle" />
                  </a>
                </td>
                <td width="50%" align="right">
                  <tal:block define="title string:_Use the cache?_"
                   content="python: mcat and mcat(title) or title" 
                   i18n:translate="" /> 
                  <input type="checkbox"
                  name="cached_templets:list" value="."
                  checked="checked"     
                  tal:attributes="value templet/getId" />
                </td>                   
              </tr>                     
            </tal:block>      
          </table>            
        </tal:block>  

        <div class="form_submit">
          <input type="submit" class="mainbutton"
          i18n:attributes="value" 
          tal:define="title string:_button_modify_"
          tal:attributes="value python:mcat and mcat(title) or title" />
        </div>
      </form>
    </tal:block>
    <tal:block condition="optimized">
      <p tal:define="title string:_This theme is completely optimized_"
         tal:content="python: mcat and mcat(title) or title"
         i18n:translate="" />
    </tal:block>
  </metal:block>
</metal:block>
