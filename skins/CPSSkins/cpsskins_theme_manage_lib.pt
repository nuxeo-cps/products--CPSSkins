
<metal:block define-macro="theme_upload"
 tal:define="io_tool here/portal_io|nothing">
  <h2 class="fancy" tal:define="title string:_Import a theme_" 
   tal:content="python: mcat and mcat(title) or title"
   i18n:translate="" i18n:domain="cpsskins" />
  <tal:block condition="nocall:io_tool">
    <tal:block define="importer string:CPSSkinsImporter;
                       importers io_tool/listImportModules;
                       error_msg options/error_msg|nothing"
               condition="python: importer in importers">
      <h3 class="fancy" tal:define="title string:_XML format_"
       tal:content="python: mcat and mcat(title) or title"
       i18n:translate="" i18n:domain="cpsskins" />
      <form tal:attributes="action string:${here_url}/cpsskins_cpsio_importer"
       method="post" enctype="multipart/form-data" i18n:domain="cpsskins">
        <label for="overwrite"
         i18n:translate="cpsio_label_cpsskins_overwrite">Overwrite existing theme in case of conflict</label>
        <input id="overwrite" type="checkbox" name="import_overwrite" /><br/>
        <input type="file" name="import_file_name" />
        <input type="hidden" name="plugin" tal:attributes="value importer" />
        <input type="submit" class="mainbutton"
        i18n:attributes="value"
        tal:define="title string:_button_import_theme_"
        tal:attributes="value python: mcat and mcat(title) or title" /><br/>
      </form>
    </tal:block>
  </tal:block>

  <form tal:attributes="action string:${here_url}/cpsskins_theme_upload"
        method="post" enctype="multipart/form-data" i18n:domain="cpsskins">
    <h3 class="fancy" tal:define="title string:_zexp format_"
     tal:content="python: mcat and mcat(title) or title"
     i18n:translate="" />
    <input type="file" name="file" />
    <input type="submit" class="mainbutton"
    i18n:attributes="value" 
    tal:define="title string:_button_import_theme_"
    tal:attributes="value python: mcat and mcat(title) or title" /><br/>
  </form>
</metal:block>

<metal:block define-macro="content_add_form" i18n:domain="cpsskins">
  <tal:block define="til here/cpsskins_listContents">
    <dl class="contentlist">
      <tal:block repeat="ti til">
        <dt tal:define="choice_id string:choice_${repeat/ti/number}">
          <input name="type_name" type="radio"
           tal:attributes="value ti/id;
                           id choice_id" />
          <img width="16" height="16" alt=""
           tal:attributes="src ti/getIcon" />
          <label for="" tal:attributes="for choice_id">
            <strong tal:define="title python: '_%s_' % ti.Title()"
                    tal:content="python: mcat and mcat(title) or title"
                    i18n:translate="" />
          </label>
        </dt>
        <dd tal:define="title ti/description"
            tal:content="python: mcat and mcat(title) or title"
            i18n:translate="" />  
      </tal:block>
    </dl>
  </tal:block>
</metal:block>

<!-- RAM Cache -->
<metal:block define-macro="cache_statistics" 
 tal:define="info python: theme_container.getCacheStats()"
 tal:condition="info">
  <tal:block define="memory python: int(info['size'] / 1024);
                     effectivity info/effectivity;
                     hits_width python: effectivity;
                     misses_width python: 100 - effectivity">
    <div style="white-space: nowrap">
      <span tal:define="title python:'_Cache effectivity_';
                        title python: mcat and mcat(title) or title"
       tal:content="title" i18n:translate="" />:
       <span tal:content="hits_width" />%
      <img height="8" alt="0" border="0" hspace="0" style="border-left: 1px solid black"
       tal:attributes="src string:${base_url}cpsskins_images/cache_hits.png;
                       width hits_width" /><img height="8" alt="0" border="0" hspace="0"
       style="border-right: 1px solid black"
       tal:attributes="src string:${base_url}cpsskins_images/cache_misses.png;
                       width misses_width" />
      &nbsp;&nbsp;-
      <span tal:define="title python:'_Memory usage_';
                        title python: cpsskins_mcat and cpsskins_mcat(title) or title"
            tal:content="title" i18n:translate="" />:
      <span tal:content="memory" />
      <span tal:define="title python:'_KB_';
                        title python: cpsskins_mcat and cpsskins_mcat(title) or title"
            tal:content="title" i18n:translate="" />
    </div>
  </tal:block>
</metal:block>

<metal:block define-macro="styles" i18n:domain="cpsskins"
  tal:define="current_style request/form/current_style|nothing;
              pss modules/Products/PythonScripts/standard; 
              stylecat request/form/style|nothing">
  <metal:block use-macro="here/cpsskins_form_widgets/macros/stylenavigation"/>
  <form tal:define="folder theme_container/getStylesFolder"
   action="" tal:attributes="action folder/absolute_url"
   name="objectItems" method="post">
    <tal:block condition="not:stylecat">
      <h1 class="fancy"
      tal:define="title string:_Edit styles_"
      tal:content="python: mcat and mcat(title) or title"
      i18n:translate="" />
      <dl>
        <tal:block repeat="ti tmtool/listStyleTypes">
          <dt tal:define="stylecat ti/getId">
            <img width="16" height="16" alt="" align="top"
             tal:attributes="src ti/getIcon" />
            <a tal:define="stylecat_quoted python: pss.url_quote_plus(stylecat);
                           title python:'_%s_' % stylecat"
               tal:attributes="href string:${here_url}/cpsskins_theme_manage_form?style=$stylecat_quoted"
               i18n:translate=""
               tal:content="python: mcat and mcat(title) or title" />
          </dt>
          <dd tal:define="title ti/description" i18n:translate=""
           tal:content="python: mcat and mcat(title) or title" />
        </tal:block>
      </dl>
    </tal:block>
    <tal:block condition="stylecat"
    define="styles python: tmtool.findStylesFor(stylecat, theme_container); 
            pastableItems python: folder.getPastableObjects(stylecat);
            style_list styles/object|nothing">
      <h2 class="fancy" tal:define="title python:'_%s_' % stylecat"
      tal:content="python: mcat and mcat(title) or title"
      i18n:translate="" />

      <metal:block use-macro="here/cpsskins_theme_manage_lib/macros/pastable_items" />
      <table tal:condition="style_list"
       class="browser" summary="" cellpadding="0" cellspacing="0">
        <tr>
          <th>&nbsp;</th>
          <th>&nbsp;</th>
          <th tal:define="title string:_Title_" i18n:translate=""
           tal:content="python: mcat and mcat(title) or title">Title</th>
        </tr>
        <tal:block repeat="style style_list">
          <tr tal:define="styleid style/getId;
                          onclick_string string:newWindow('${style/absolute_url}/edit_form?style=$stylecat');
                          even repeat/style/even;"
              tal:attributes="class python: even and 'even' or None">
            <td width="20">
              <input type="checkbox" name="ids:list"
               tal:attributes="value styleid" />
            </td>
            <td width="20">
              <img src="" alt="" width="16" height="16"
               tal:attributes="src python: base_url + style.getIcon(1)" />
            </td>
            <td>
              <a href="javascript:void(0)"
               tal:attributes="onClick onclick_string;
                               onmouseover string:toggle('$styleid');
                               onmouseout string:toggle('$styleid')"
               tal:content="python: style.title_or_id()" />
            </td>
          </tr>
        </tal:block>
      </table>
      <tal:block repeat="style style_list">
        <div class="previewBox hidden"
         tal:content="structure python: style.preview()"
         tal:attributes="id style/getId" />
      </tal:block>
      <br />
      <tal:block condition="style_list">
        <input type="submit" name="cutObjects:method"
         value="Cut" i18n:attributes="value"
         tal:define="title string:_Cut_"
         tal:attributes="value python: mcat and mcat(title) or title" />
        <input type="submit" name="copyObjects:method"
         value="Copy" i18n:attributes="value"
         tal:define="title string:_Copy_"
         tal:attributes="value python: mcat and mcat(title) or title" />
        <input type="submit" name="deleteObjects:method"
         value="Delete" i18n:attributes="value"
         tal:define="title string:_Delete_"
         tal:attributes="value python: mcat and mcat(title) or title" />
      </tal:block>
      <input type="submit" name="pasteObjects:method"
       value="Paste" i18n:attributes="value"
       tal:define="title string:_Paste_"
       tal:condition="pastableItems"
       tal:attributes="value python: mcat and mcat(title) or title" />
    </tal:block>
    <div class="addItem">
      <a href="javascript:void(0)" alt=""
      tal:attributes="onClick string:newWindow('${base_url}cpsskins_addstyle_form?type_name=$stylecat')">
        <img width="46" height="18" alt=""
        tal:attributes="src string:${base_url}cpsskins_images/img_addstyle.png" />
      </a>
    </div>
  </form>
</metal:block>

<metal:block define-macro="images" i18n:domain="cpsskins"
  tal:define="current_image request/form/current_image|nothing; 
              imagecat request/form/imagecat|nothing; 
              sections here/cpsskins_listImageCategories;
              pss modules/Products/PythonScripts/standard">
    <metal:block use-macro="here/cpsskins_form_widgets/macros/imagenavigation"/>
    <tal:block condition="python: imagecat not in sections">
      <h1 class="fancy"
      tal:define="title string:_Edit images_"
      tal:content="python: mcat and mcat(title) or title"
      i18n:translate="" />
      <dl>
        <tal:block repeat="imagecat sections">
          <dt><img tal:attributes="src string:${base_url}themefolder.png" align="top" />
            <a tal:define="imagecat_quoted python: pss.url_quote_plus(imagecat);
                           title python:'_%s_' % imagecat"
               tal:attributes="href string:${here_url}/cpsskins_theme_manage_form?imagecat=$imagecat_quoted"
               i18n:translate="" 
               tal:content="python: mcat and mcat(title) or title" />
          </dt>
        </tal:block>
      </dl>
    </tal:block>
    <tal:block condition="python: imagecat in sections">
      <h2 class="fancy" tal:define="title python:'_%s_' % imagecat"
      tal:content="python: mcat and mcat(title) or title"
      i18n:translate="" />
      <form tal:define="
            folder python: theme_container.getImageFolder(category=imagecat);
            pastableItems python: folder.getPastableObjects('Image');
            images python: here.cpsskins_listImages(imagecat=imagecat)"
       action="" tal:attributes="action folder/absolute_url"
       name="objectItems" method="post">
        <metal:block use-macro="here/cpsskins_theme_manage_lib/macros/pastable_items" />
        <table tal:condition="images"
         class="browser" summary="" cellpadding="0" cellspacing="0">
          <tr>
            <th>&nbsp;</th>
            <th tal:define="title string:_Title_" i18n:translate=""
             tal:content="python: mcat and mcat(title) or title">Title</th>
            <th tal:define="title string:_size_" i18n:translate=""
             tal:content="python: mcat and mcat(title) or title">Size</th>
            <th tal:define="title string:_dimensions_" i18n:translate=""
             tal:content="python: mcat and mcat(title) or title">Dimensions</th>
            <th style="text-align: center" tal:define="title string:_Preview_" i18n:translate=""
             tal:content="python: mcat and mcat(title) or title">Preview</th>
            <th>&nbsp;</th>
          </tr>
          <tal:block repeat="image images">
            <tr tal:define="imageid image/getId;
                            onclick_string string:newWindow('${image/absolute_url}/cpsskins_image_edit_form?imagecat=$imagecat');
                            even repeat/image/even;"
                tal:attributes="class python: even and 'even' or None">
              <td width="20">
                <input type="checkbox" name="ids:list" tal:attributes="value imageid" />
              </td>
              <td>
                <a href="javascript:void(0)"
                 tal:attributes="onClick onclick_string"
                 tal:content="imageid" />
              </td>
              <td tal:content="string:${image/size} bytes" />              
              <td tal:content="string:${image/width}x${image/height} px" />
              <td align="center">
                <a style="cursor: help"
                 href="javascript:void(0)" 
                 tal:attributes="onClick onclick_string;
                                 onmouseover string:toggle('$imageid');
                                 onmouseout string:toggle('$imageid')"
                 tal:content="structure python: here.cpsskins_imagePreview(image=image, imagecat=imagecat, inline=1)" />
              </td>
              <td tal:define="here nocall:image">
                <metal:block use-macro="here/cpsskins_theme_widgets/macros/edit_online" />
              </td>
            </tr>
          </tal:block>
        </table>
        <tal:block repeat="image images">
          <div class="previewBox hidden"
           tal:attributes="id image/getId"
           tal:content="structure python: here.cpsskins_imagePreview(image=image, imagecat=imagecat)" />
        </tal:block>
        <br />
        <tal:block condition="images">
          <input type="submit" name="cutObjects:method"
           value="Cut" i18n:attributes="value"
           tal:define="title string:_Cut_"
           tal:attributes="value python: mcat and mcat(title) or title" />
          <input type="submit" name="copyObjects:method"
           value="Copy" i18n:attributes="value"
           tal:define="title string:_Copy_"
           tal:attributes="value python: mcat and mcat(title) or title" />
          <input type="submit" name="deleteObjects:method"
           value="Delete" i18n:attributes="value"
           tal:define="title string:_Delete_"
           tal:attributes="value python: mcat and mcat(title) or title" />
        </tal:block>
        <input type="submit" name="pasteObjects:method"
         value="Paste" i18n:attributes="value"
         tal:define="title string:_Paste_"
         tal:condition="pastableItems"
         tal:attributes="value python: mcat and mcat(title) or title" />
      </form>
      <div class="addItem">
        <a href="javascript:void(0)" alt=""
         tal:attributes="onClick string:newWindow('${theme_container_url}/$imagecat/cpsskins_addimage_form')">
          <img width="46" height="18" alt=""
           tal:attributes="src string:${base_url}cpsskins_images/img_addimage.png" />
        </a>
      </div>
    </tal:block>
</metal:block>

<metal:block define-macro="palettes" i18n:domain="cpsskins"
  tal:define="pss modules/Products/PythonScripts/standard;
              palettecat request/form/palette|nothing">
    <metal:block use-macro="here/cpsskins_form_widgets/macros/palettenavigation"/>
    <tal:block condition="not:palettecat">
      <h1 class="fancy"
       tal:define="title string:_Edit palettes_"
       tal:content="python: mcat and mcat(title) or title"
       i18n:translate="" />
      <dl>
        <tal:block repeat="ti tmtool/listPaletteTypes">
          <dt tal:define="palettecat ti/getId">
            <img width="16" height="16" alt="" align="top"
             tal:attributes="src ti/getIcon" />
            <a tal:define="palettecat_quoted python: pss.url_quote_plus(palettecat);
                           title python:'_%s_' % palettecat"
               tal:attributes="href string:${here_url}/cpsskins_theme_manage_form?palette=$palettecat_quoted"
               i18n:translate=""
               tal:content="python: mcat and mcat(title) or title" />
          </dt>
          <dd tal:define="title ti/description" i18n:translate=""
           tal:content="python: mcat and mcat(title) or title" />
        </tal:block>
      </dl>
    </tal:block>
    <tal:block condition="palettecat"
    define="palettes python: tmtool.listPalettes(palettecat, theme_container);
            palette_list palettes/object|nothing;">
      <h2 class="fancy" tal:define="title python:'_%s_' % palettecat"
      tal:content="python: mcat and mcat(title) or title" 
      i18n:translate="" />
      <form tal:define="folder theme_container/getPalettesFolder;
            pastableItems python: folder.getPastableObjects(palettecat)"
       action="" tal:attributes="action folder/absolute_url"
       name="objectItems" method="post">
        <metal:block use-macro="here/cpsskins_theme_manage_lib/macros/pastable_items" />
        <table tal:condition="palette_list"
         class="browser" summary="" cellpadding="0" cellspacing="0">
          <tr>
            <th>&nbsp;</th>
            <th>&nbsp;</th>
            <th tal:define="title string:_Title_" i18n:translate=""
             tal:content="python: mcat and mcat(title) or title">Title</th>
            <th tal:define="title string:_Value_" i18n:translate=""
             tal:content="python: mcat and mcat(title) or title">Value</th>
            <th style="text-align: center" tal:define="title string:_Preview_" i18n:translate=""
             tal:content="python: mcat and mcat(title) or title">Preview</th>
          </tr>
          <tal:block repeat="palette palette_list">
            <tr tal:define="paletteid palette/getId;
                            onclick_string string:newWindow('${palette/absolute_url}/edit_form?palette=$palettecat');
                            even repeat/palette/even;"
                tal:attributes="class python: even and 'even' or None">
              <td width="20">
                <input type="checkbox" name="ids:list" tal:attributes="value paletteid" />
              </td>
              <td width="20">
                <img src="" alt="" width="16" height="16"
                 tal:attributes="src python: base_url + palette.getIcon(1)" />
              </td>
              <td>
                <a href="javascript:void(0)"
                 tal:attributes="onClick onclick_string;
                                 onmouseover string:toggle('$paletteid');
                                 onmouseout string:toggle('$paletteid')"
                 tal:content="python: palette.title_or_id()" />
              </td>
              <td>
                <tal:block content="palette/value" />
              </td>
              <td align="center">
                <a href="javascript:void(0)"
                 tal:content="structure python: palette.preview(inline=1)"
                 tal:attributes="onClick onclick_string;
                                 onmouseover string:toggle('$paletteid');
                                 onmouseout string:toggle('$paletteid')" />
              </td>
            </tr>
          </tal:block>
        </table>

        <tal:block repeat="palette palette_list">
          <div class="previewBox hidden"
           tal:attributes="id palette/getId"
           tal:content="structure python: palette.preview()" />
        </tal:block>
        <br />
        <tal:block condition="palette_list">
          <input type="submit" name="cutObjects:method"
           value="Cut" i18n:attributes="value"
           tal:define="title string:_Cut_"
           tal:attributes="value python: mcat and mcat(title) or title" />
          <input type="submit" name="copyObjects:method"
           value="Copy" i18n:attributes="value"
           tal:define="title string:_Copy_"
           tal:attributes="value python: mcat and mcat(title) or title" />
          <input type="submit" name="deleteObjects:method"
           value="Delete" i18n:attributes="value"
           tal:define="title string:_Delete_"
           tal:attributes="value python: mcat and mcat(title) or title" />
        </tal:block>
        <input type="submit" name="pasteObjects:method"
         value="Paste" i18n:attributes="value"
         tal:define="title string:_Paste_"
         tal:condition="pastableItems"
         tal:attributes="value python: mcat and mcat(title) or title" />
      </form>
      <div class="addItem">
        <a href="javascript:void(0)" alt=""
        tal:attributes="onClick string:newWindow('${base_url}cpsskins_addpalette_form?type_name=$palettecat')">
          <img width="46" height="18" alt=""
           tal:attributes="src string:${base_url}cpsskins_images/img_addpalette.png" />
        </a>
      </div>
    </tal:block>
</metal:block>

<metal:block define-macro="pastable_items">
  <div class="pastableItems" tal:condition="pastableItems">
    <em i18n:domain="cpsskins" i18n:translate=""
    tal:define="title string:_Some items can be pasted here_"
    tal:content="python: mcat and mcat(title) or title" />:
    <tal:block repeat="item pastableItems">
      <strong tal:content="item/title_or_id" /><tal:block condition="not:repeat/item/end"
       content="structure string:,&nbsp;" />
    </tal:block>
  </div>
</metal:block>

<metal:block define-macro="themes_manager"
  tal:define="themes python: tmtool.getThemes()">
    <h1 class="fancy" i18n:domain="cpsskins"
    tal:define="title string:_Themes manager_"
    tal:content="python: mcat and mcat(title) or title"
    i18n:translate="" />
    <div class="statusMessage" i18n:translate=""
       tal:define="psm options/portal_status_message|request/portal_status_message|nothing"
       tal:condition="psm"
       tal:content="psm" />
    <p tal:define="title string:_Select a theme to manage_"
    tal:content="python: mcat and mcat(title) or title"
    i18n:translate="" i18n:domain="cpsskins" />
      <form action="" method="post" i18n:domain="cpsskins"
        tal:attributes="action string:${base_url}cpsskins_themes_edit">
        <input type="hidden" name="theme"
        tal:attributes="value current_theme" />
        <table border="0" cellpadding="2" cellspacing="0"
         class="tableFrame" width="100%" summary="">
          <tr class="tableHeader">
             <td>&nbsp;</td>
             <td>
                 <strong i18n:translate=""
                  tal:define="title string:_Theme name_"
                  tal:content="python: mcat and mcat(title) or title" />
             </td>
             <td align="center">
                 <strong i18n:translate="" 
                  tal:define="title string:_Default theme_"
                  tal:content="python: mcat and mcat(title) or title" />
             </td>
             <td align="center">
                 <strong i18n:translate="" 
                  tal:define="title string:_Delete theme?_"
                  tal:content="python: mcat and mcat(title) or title" />
             </td>
          </tr>
          <tal:block repeat="theme themes">
              <tr tal:define="default_theme theme/default|nothing;
                              theme_id theme/id|nothing"
                  tal:attributes="style python: theme_id == current_theme and 'background-color: #fcfcfc' or ''">
                  <td width="16">
                    <img src="" align="middle" alt=""
                    tal:attributes="src python: base_url + theme.getIcon(1)" />
                  </td>
                  <td>
                    <a tal:attributes="href string:${tmtool_url}/setViewMode?theme=$theme_id&amp;themes_panel=theme&amp;reload=1;
                                       style python: default_theme and 'text-decoration: underline' or ''"
                       tal:content="python: '%s (%s)' % (theme_id, theme.title_or_id())" />
                  </td>
                  <td align="center">
                    <input type="radio" name="default_theme:list"
                    value="."
                    tal:attributes="checked default_theme; value theme_id" />
                  </td>
                  <td align="center">
                    <input type="checkbox" name="delete_themes:list"
                    value="."
                    tal:attributes="value theme_id" />
                  </td>
              </tr>
          </tal:block>
        </table>
        <div class="formSubmit">
          <input type="submit" class="mainbutton"
          i18n:attributes="value" 
          tal:define="title string:_button_modify_"
          tal:attributes="value python:mcat and mcat(title) or title" />
        </div>
      </form>

      <metal:block use-macro="here/cpsskins_theme_manage_lib/macros/theme_upload" />

      <h2 class="fancy" tal:define="title string:_Add a theme_"
      tal:content="python: mcat and mcat(title) or title"
      i18n:translate="" i18n:domain="cpsskins" />
      <div class="addItem">
        <form action="cpsskins_theme_add" method="get">
          <input type="image" type="submit" 
           tal:attributes="src string:${base_url}cpsskins_images/img_addtheme.png" />
        </form>
      </div>
</metal:block>

<metal:block define-macro="other_themes" i18n:domain="cpsskins">
  <a tal:attributes="href string:${tmtool_url}/setViewMode?themes_panel=themes_manager&amp;reload=1"
   i18n:translate="" class="linkUp"
   tal:define="title string:_Other themes_"
   tal:content="python: mcat and mcat(title) or title" />
</metal:block>

<metal:block define-macro="cache_manager" i18n:domain="cpsskins">
    <h2 class="fancy" tal:define="title string:_Cache manager_"
    tal:content="python: mcat and mcat(title) or title"
    i18n:translate="" />

    <form action="manage_clearCache"
     tal:attributes="action string:${theme_container_url}/cpsskins_clear_cache">
      <table cellpadding="0" cellspacing="2" width="100%" summary="">
        <tr>
          <td>
            <metal:block use-macro="here/cpsskins_theme_manage_lib/macros/cache_statistics" />
          </td>
          <td align="right">
             <input type="submit" class="invalidateCache"
             i18n:attributes="value" 
             tal:define="title string:_button_clear_the_cache_"
             tal:attributes="value python: mcat and mcat(title) or title" />
          </td>
        </tr>
      </table>
    </form>

    <form action="cpsskins_cache_edit" method="post">
      <table border="0" cellpadding="2" cellspacing="0"
       width="100%" summary="" class="tableFrame">
        <tal:block repeat="pageblock python: page_container.getPageBlocks()">
          <tr clss="tableHeader">
            <td colspan="4">
              <h3 class="fancy" tal:content="pageblock/title_or_id" />
            </td>
          </tr>
          <tal:block define="objects python: pageblock.getObjects();
                             maxcols python: pageblock['maxcols']"
                     repeat="x_pos python: range(int(maxcols))">
            <tal:block 
             define="objects_in_xpos python: objects.get(x_pos, None)"
             condition="objects_in_xpos">
              <tal:block repeat="content python: objects_in_xpos['contents']">
                <tr tal:condition="content/isCacheable|nothing"
                    tal:define="content_cacheable content/cacheable|nothing">
                  <td>
                    <img align="middle"
                    tal:attributes="src python: base_url + content.getIcon(1)" />
                    <a href="javascript:void(0)"
                     tal:attributes="onClick string:newWindow('${content/absolute_url}/edit_form')"
                     tal:content="python: content.title_or_id()" />
                    <input type="hidden" name="paths" 
                    tal:attributes="value python: '/'.join(content.getPhysicalPath())" />
                  </td>
                  <td tal:define="ti content/getTypeInfo">
                    <span tal:condition="ti" tal:content="ti/getId" />
                    <span tal:condition="not:ti" tal:content="string:?" />
                  </td>
                  <td align="center">
                    <span i18n:translate=""
                    tal:define="title string:_Cacheable?_"
                    tal:content="python: mcat and mcat(title) or title" />
                    <input type="checkbox" name="cache:list"
                    value="."
                    tal:attributes="checked content_cacheable; value content/getId" />
                  </td>
                  <td> 
                    <select name="cache_lifetimes:list">
                      <tal:block repeat="lifetime content/listLifeTimes">
                        <option i18n:translate="" 
                         tal:define="cache_lifetime content/cache_lifetime|nothing;
                                     i18n_option string:_option_lifetime_${lifetime}_;
                                     i18n_lifetime python: mcat and mcat(i18n_option) or i18n_option"
                         tal:attributes="value lifetime;
                                         selected python: lifetime == cache_lifetime"
                         tal:content="i18n_lifetime" />
                      </tal:block>
                    </select>
                  </td>
                </tr>
              </tal:block>
            </tal:block>
          </tal:block>
        </tal:block>
      </table>
      <div class="formSubmit">
        <input type="submit" class="mainbutton"
        i18n:attributes="value"
        tal:define="title string:_button_modify_"
        tal:attributes="value python: mcat and mcat(title) or title" />
      </div>
    </form>
</metal:block>

<metal:block define-macro="theme_manager" i18n:domain="cpsskins">
  <tal:block define="object theme_container;
                     redirect_url string:${base_url}cpsskins_theme_manage_form">
    <h1 class="fancy" tal:define="title string:_Edit_">
     <tal:block i18n:translate="" content="python: mcat and mcat(title) or title" />
    '<tal:block replace="theme_container/title|nothing" />'
    </h1>
    <metal:block use-macro="here/cpsskins_form_widgets/macros/edit_form" />
  </tal:block>
</metal:block>

<metal:block define-macro="theme_exporter" tal:define="
  io_tool here/portal_io|nothing">
  <tal:block condition="nocall:io_tool">
    <tal:block define="exporter string:CPSSkinsExporter;
                       exporters io_tool/listExportModules;
                       error_msg options/error_msg|nothing"
               condition="python: exporter in exporters">
      <h2 class="fancy" tal:define="title string:_XML export_"
       tal:content="python: mcat and mcat(title) or title"
       i18n:translate="" i18n:domain="cpsskins" />
      <form method="post" action="." enctype="multipart/form-data">
        <input type="text" name="export_file_name"
         tal:attributes="value string:${current_theme}.zip" />
        <input type="hidden" name="theme"
         tal:attributes="value current_theme" />
        <input type="submit" name="cpsskins_cpsio_exporter:method"
         class="standalone" value="cpsio_button_export"
         i18n:attributes="value" />
      </form>
    </tal:block>
  </tal:block>
  <h2 class="fancy" tal:define="title string:_zexp export_"
   tal:content="python: mcat and mcat(title) or title"
   i18n:translate="" i18n:domain="cpsskins" />
  <form action=""
   tal:attributes="action string:${theme_container_url}/manage_exportObject">
    <input type="hidden" name="download" value="1" />
    <input type="submit" class="ExportTheme"
     tal:define="title string:_button_export_theme_"
     i18n:attributes="value" i18n:domain="cpsskins"
     tal:attributes="value python: mcat and mcat(title) or title" />
  </form>
</metal:block>

<metal:block define-macro="theme_optimizer" i18n:domain="cpsskins" tal:define="
  dummy theme_container/rebuild;
  unused_styles theme_container/findOrphanedStyles|nothing; 
  identical_styles theme_container/findIdenticalStyles|nothing; 
  invisible_templets theme_container/getInvisibleTemplets|nothing; 
  uncached_templets theme_container/findUncachedTemplets|nothing;
  i18n_templets theme_container/getI18nTemplets|nothing;
  optimized python: not (unused_styles or invisible_templets or uncached_templets or identical_styles or i18n_templets)">
    <h2 class="fancy" tal:define="title string:_Theme optimizer_"
    tal:content="python: mcat and mcat(title) or title"
    i18n:translate="" />
    <tal:block condition="not:optimized">
      <form action="" method="post"
      tal:attributes="action string:${base_url}cpsskins_theme_optimize">
        <input type="hidden" name="theme" value="" 
         tal:attributes="value current_theme" />
        <input type="hidden" name="page" value="" 
         tal:attributes="value current_page" />
        <tal:block tal:condition="unused_styles">
          <h3 class="fancy"
          tal:define="title string:_Styles_"
          tal:content="python: mcat and mcat(title) or title"
          i18n:translate="" />
          <p tal:define="title string:_These styles are not used and can be deleted:_"
             tal:content="python: mcat and mcat(title) or title"
             i18n:translate="" />
          <table border="0" cellpadding="2" cellspacing="0" summary=""
          class="tableFrame" width="100%">
            <tal:block repeat="style unused_styles">
              <tr>
                <td width="20">
                  <img src="" alt=""
                   tal:attributes="src python: base_url + style.getIcon(1)" />
                </td>
                <td>
                  <a href="javascript:void(0)"
                   tal:attributes="onClick string:newWindow('${style/absolute_url}/edit_form')"
                   tal:content="style/getTitle" />
                </td>
                <td width="25%">
                  <span tal:define="title python:'_%s_' % style.meta_type"
                   tal:content="python: mcat and mcat(title) or title"
                   i18n:translate="" />
                </td>
                <td width="25%" align="right">
                  <tal:block define="title string:_Delete style?_"
                     content="python: mcat and mcat(title) or title" 
                     i18n:translate="" />
                  <input type="checkbox" name="delete_styles:list"
                  value="." checked="checked"
                  tal:attributes="value style/getId" />
                </td>
              </tr>
            </tal:block>
          </table>
        </tal:block>
        <tal:block condition="identical_styles"
        define="style_types python: identical_styles.keys()">
          <p tal:define="title string:_These styles are identical and can be merged together:_"
             tal:content="python: mcat and mcat(title) or title"
             i18n:translate="" />
          <tal:block repeat="style_type style_types">
            <tal:block define="styles_by_type python: identical_styles[style_type]">

              <tal:block repeat="blocks styles_by_type">
                <table border="0" cellpadding="2" cellspacing="0"
                class="tableFrame" width="100%">
                  <tr class="tableHeader" tal:condition="styles_by_type">
                    <td colspan="3">
                      <span tal:define="title python:'_%s_' % style_type"
                       tal:content="python: mcat and mcat(title) or title"
                       i18n:translate="" />
                    </td>
                  </tr>
                  <tal:block repeat="style blocks">
                    <tr>
                      <td width="20">
                        <img tal:attributes="src python: base_url + style.getIcon(1)" />
                      </td>
                      <td>
                        <a href="javascript:void(0)"
                         tal:attributes="onClick string:newWindow('${style/absolute_url}/edit_form')"
                         tal:content="style/getTitle" />
                      </td>
                      <td align="right">
                        <tal:block define="title string:_Merge this style?_"
                         content="python: mcat and mcat(title) or title"
                         i18n:translate="" />
                        <input type="checkbox" name="" value="."
                        checked="checked"
                        tal:attributes="value style/getId; name string:merge_styles_${repeat/style_type/number}${repeat/blocks/number}" />
                      </td>
                    </tr>
                  </tal:block>
                </table>
              </tal:block>
            </tal:block>
          </tal:block>
        </tal:block>

        <tal:block condition="i18n_templets">
          <h3 class="fancy"
           tal:define="title string:_Translations_"
           tal:content="python: mcat and mcat(title) or title"
          i18n:translate="" />
          <p tal:define="title string:_Only select items that are supposed to get translated:_"
             tal:content="python: mcat and mcat(title) or title"
             i18n:translate=""  />
          <table border="0" cellpadding="5" cellspacing="0"
          class="tableFrame" width="100%">
            <tr tal:repeat="templet i18n_templets">
              <td width="30%">
                <img tal:attributes="src python: base_url + templet.getIcon(1)" />
                <a href="javascript:void(0)"
                 tal:attributes="onClick string:newWindow('${templet/absolute_url}/edit_form')"
                 tal:content="templet/getTitle" />
              </td>
              <td width="70%" align="right">
                <table cellpadding="0" cellspacing="0">
                  <tr tal:repeat="prop_id templet/getI18nProperties">
                    <td align="right">
                      <tal:block define="label python: [p['label'] for p in templet.propertyMap() if p['id'] == prop_id];
                                         title python: label and'_%s_' % label[0] or prop_id"
                         condition="python: getattr(templet, prop_id)">
                        <span tal:content="python: mcat and mcat(title) or title" 
                         i18n:translate="" /> 
                        <input type="checkbox"
                         checked="checked"
                         name="items_to_translate:list" value="."
                         tal:attributes="value string:${templet/getId}:$prop_id">
                      </tal:block>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </tal:block>

        <tal:block condition="invisible_templets">
          <h3 class="fancy" 
           tal:define="title string:_Templets_"
           tal:content="python: mcat and mcat(title) or title"
          i18n:translate="" />
          <p tal:define="title string:_These Templets are invisible and can be deleted:_"
             tal:content="python: mcat and mcat(title) or title"
             i18n:translate=""  />
          <table border="0" cellpadding="2" cellspacing="0"
          class="tableFrame" width="100%">
            <tal:block repeat="templet invisible_templets">
              <tr>
                <td width="20">
                  <img tal:attributes="src python: base_url + templet.getIcon(1)" />
                </td>
                <td>
                  <a href="javascript:void(0)"
                   tal:attributes="onClick string:newWindow('${templet/absolute_url}/edit_form')"
                   tal:content="templet/getTitle" />
                </td>
                <td width="50%" align="right">
                  <tal:block define="title string:_Delete Templet?_"
                   content="python: mcat and mcat(title) or title" 
                   i18n:translate="" />
                  <input type="checkbox"
                  name="delete_templets:list" value="."
                  checked="checked"
                  tal:attributes="value python: '/'.join(templet.getPhysicalPath())" />
                </td>
              </tr>
            </tal:block>
          </table>
        </tal:block>

        <tal:block condition="uncached_templets">
          <h3 class="fancy"
           tal:define="title string:_Templets_"
           tal:content="python: mcat and mcat(title) or title"
          i18n:translate="" />
          <p tal:define="title string:_These Templets could be cached in memory for faster rendering:_"
             tal:content="python: mcat and mcat(title) or title"
             i18n:translate=""  />
          <table border="0" cellpadding="2" cellspacing="0"
          class="tableFrame" width="100%">
            <tal:block repeat="templet uncached_templets">
              <tr>
                <td width="20">
                  <img tal:attributes="src python: base_url + templet.getIcon(1)" />
                </td>
                <td>
                  <a href="javascript:void(0)"
                  tal:attributes="onClick string:newWindow('${templet/absolute_url}/edit_form?cat=general')"
                  tal:content="templet/getTitle" />
                </td>
                <td tal:define="page templet/getPage"
                 tal:content="page/title_or_id" />
                <td width="50%" align="right">
                  <tal:block define="title string:_Use the cache?_"
                   content="python: mcat and mcat(title) or title"
                   i18n:translate="" />
                  <input type="checkbox"
                  name="cached_templets:list" value="."
                  checked="checked"
                  tal:attributes="value python: '/'.join(templet.getPhysicalPath())" />
                </td>
              </tr>
            </tal:block>
          </table>
        </tal:block>
        <div class="formSubmit">
          <input type="submit" class="mainbutton"
          i18n:attributes="value" 
          tal:define="title string:_button_modify_"
          tal:attributes="value python:mcat and mcat(title) or title" />
        </div>
      </form>
    </tal:block>
    <tal:block condition="optimized">
      <p tal:define="title string:_This theme is completely optimized_"
         tal:content="python: mcat and mcat(title) or title"
         i18n:translate="" />
    </tal:block>
</metal:block>

<metal:block define-macro="manage_theme" i18n:domain="cpsskins">
  <div style="padding-top: 10px">
    <form name="optimizetheme" action="" style="float: left; padding: 3px"
     tal:attributes="action string:${tmtool_url}/setViewMode">
      <input type="hidden" name="reload" value="1" />
      <input type="hidden" name="themes_panel"
       tal:attributes="value string:theme_optimizer" />
      <input type="submit" class="optimizeTheme"
       tal:define="title string:_button_optimize_theme_"
       i18n:attributes="value" 
       tal:attributes="value python: mcat and mcat(title) or title" />
    </form>
    <form name="cachemanager" action="" style="float: left; padding: 3px"
     tal:attributes="action string:${tmtool_url}/setViewMode">
      <input type="hidden" name="reload" value="1" />
      <input type="hidden" name="themes_panel"
       tal:attributes="value string:cache_manager" />
      <input type="submit" class="cacheManager"
       tal:define="title string:_button_cache_manager_"
       i18n:attributes="value" 
       tal:attributes="value python: mcat and mcat(title) or title" />
    </form>
    <form name="rebuildtheme" action="" style="float: left; padding: 3px"
     tal:attributes="action string:${theme_container_url}/cpsskins_rebuildtheme">
      <input type="submit" class="rebuildTheme"
       i18n:attributes="value" 
       tal:attributes="value python: mcat and mcat('_button_rebuild_theme_') or '_button_rebuild_theme_'" />
    </form>
    <form name="exporttheme" action="" style="float: left; padding: 3px"
     tal:attributes="action string:${tmtool_url}/setViewMode">
      <input type="hidden" name="reload" value="1" />
      <input type="hidden" name="themes_panel"
       tal:attributes="value string:theme_exporter" />
      <input type="submit" class="exportTheme"
       tal:define="title string:_button_export_theme_"
       i18n:attributes="value" 
       tal:attributes="value python: mcat and mcat(title) or title" />
    </form>
  </div>
  <br style="clear: left" />
</metal:block>
