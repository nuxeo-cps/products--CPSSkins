<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<metal:block use-macro="here/cpsskins_edit_macro/macros/edit" i18n:domain="cpsskins">
  <metal:block fill-slot="edit"
  tal:define="pss modules/Products/PythonScripts/standard; 
              palettecat request/form/palette|nothing;
              mtool here/portal_membership;
              checkPerm nocall:mtool/checkPermission">
    <tal:block condition="python: not checkPerm('Manage Themes', here)"> 
      <tal:block define="dummy request/RESPONSE/unauthorized" />
    </tal:block>
    <metal:block use-macro="here/cpsskins_form_widgets/macros/palettenavigation" />
    <tal:block condition="not:palettecat">
      <h1 tal:define="title string:_Edit palettes_"
       tal:content="python: mcat and mcat(title) or title"
      i18n:translate="" />
      <table cellpadding="3" cellspacing="0" border="0" summary="">
        <tal:block repeat="obj here/cpsskins_listPalettes">
          <tal:block define="palettecat obj/getId">
            <tr>
              <td valign="top">
                <img tal:attributes="src string:${base_url}${obj/getIcon}" />
              </td>
              <td>
                <a tal:define="palettecat_quoted python: pss.url_quote_plus(palettecat);
                               title python:'_%s_' % palettecat"
                   tal:attributes="href string:${here_url}/cpsskins_edit_palettes?palette=$palettecat_quoted"
                   i18n:translate=""
                   tal:content="python: mcat and mcat(title) or title" />
                <p tal:define="title obj/description"
                i18n:translate=""
                tal:content="python: mcat and mcat(title) or title" />
              </td>
            </tr>
          </tal:block>
        </tal:block>
      </table>
    </tal:block>
    <tal:block condition="palettecat"
    define="palettes python: tmtool.listPalettes(palettecat, here); palette_list palettes/object|nothing;">
      <h1 tal:define="title python:'_%s_' % palettecat"
      tal:content="python: mcat and mcat(title) or title" 
      i18n:translate="" />
      <tal:block repeat="palette palette_list">
        <div class="EditPreview">
          <tal:block define="info palette/getInfo; del_action info/delete|nothing; edit_action info/edit|nothing;">

            <a title="Delete"
            tal:condition="del_action/can_delete|nothing"
            tal:define="msg string:_Deleting this palette entry, are you sure?_;
                        msg python: cpsskins_mcat and cpsskins_mcat(msg) or msg;
                        onclick_msg python:'return window.confirm(\'%s\')' % msg"
            tal:attributes="onclick onclick_msg;
                            href string:${del_action/url}?goto=referer" >
              <img border="0" width="12" height="12"
              tal:attributes="src string:${base_url}cpsskins_images/img_palette_delete.png" />
            </a>
            <a tal:attributes="href string:${palette/absolute_url}/edit_form?palette=$palettecat">
              <tal:block content="palette/title" />
              <br />
              <br />
              <tal:block content="structure python: palette.preview()" />
            </a>
          </tal:block>
        </div>
      </tal:block>
      <form action="cpsskins_palette_add" method="get">
        <input type="hidden" name="type_name" value=""
        tal:attributes="value palettecat" />
        <input type="image" type="submit"
        tal:attributes="src string:${base_url}cpsskins_images/img_addpalette.png" />
      </form>
    </tal:block>
  </metal:block>
</metal:block>
