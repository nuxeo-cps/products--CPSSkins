<metal:block define-macro="defines"
tal:define="global here_url here_url|here/absolute_url;
            tmtool here/portal_themes; 
            global mcat here/cpsskins_getlocalizer;
            global current_theme python: tmtool.getRequestedThemeName(context=here);
            global theme_container python: tmtool.getEffectiveThemeContainer(theme=current_theme);
            theme_renderer theme_container/theme_renderer|nothing;
            renderer python: tmtool.getThemeRenderer(theme_renderer=theme_renderer);
            global main_macro python: 'cpsskins_main_template_%s' % renderer;
            global enable_esi theme_container/esi|nothing;
            global cpsskins_pagemargin theme_container/margin|nothing;
            global cpsskins_bodycolor theme_container/color|nothing;
            global cpsskins_language tmtool/getCurrentLang;
            global cpsskins_url here/cpsskins_getCurrentURL;
            global boxedit boxedit|nothing;
            global shield python: 1;
            dummy python: request.set('cpsskins_language', cpsskins_language);
            dummy python: request.set('cpsskins_url', cpsskins_url);
            dummy python: request.set('cpsskins_base_url', here.cpsskins_getBaseUrl());
            dummy python: enable_esi and here.cpsskins_set_esi_header();
"/>
