<metal:block define-macro="defines"
tal:define="tmtool here/portal_themes; 
            global mcat here/cpsskins_getlocalizer;
            global edit_mode request/form/edit_mode|nothing; 
            cpsskins_theme python: tmtool.getLocalThemeName(here);
            dummy python: request.set('cpsskins_theme', cpsskins_theme);
            global current_theme python: tmtool.getRequestedThemeName(REQUEST=request);
            global theme_container python: tmtool.getEffectiveThemeContainer(theme=current_theme); 
            theme_renderer theme_container/theme_renderer|nothing;
            renderer python: tmtool.getThemeRenderer(theme_renderer=theme_renderer, REQUEST=request);
            main_macro_suffix python: edit_mode and 'edit' or renderer;
            global main_macro python: 'cpsskins_main_template_%s' % main_macro_suffix;
            global enable_esi theme_container/esi|nothing;
            global cpsskins_pagemargin theme_container/margin|nothing;
            global cpsskins_bodycolor theme_container/color|nothing;
            global cpsskins_language here/cpsskins_getCurrentLang;
            global cpsskins_url here/cpsskins_getCurrentURL;
            global boxedit boxedit|nothing;
            dummy python: request.set('cpsskins_language', cpsskins_language);
            context_rurl request/form/context_rurl|nothing;
            context_obj python: here.cpsskins_getContextObj(context_rurl);
            dummy python: request.set('context_obj', context_obj);
            dummy python: request.set('cpsskins_url', cpsskins_url);
            dummy python: request.set('cpsskins_base_url', here.cpsskins_getBaseUrl());
            dummy python: enable_esi and here.cpsskins_set_esi_header();
"/>
