<metal:block define-macro="defines"
tal:define="global here_url here_url|here/absolute_url;
            global tmtool here/portal_themes; 
            global mcat python: tmtool.getTranslationService();
            global base_url python: here.cpsskins_getBaseUrl();
            current_view python: tmtool.getEffectiveThemeAndPageName(context_obj=here);
            global current_theme python: current_view[0];
            global current_page python: current_view[1];
            global theme_container python: tmtool.getThemeContainer(theme=current_theme);
            global page_container python: theme_container.getPageContainer(current_page);
            page_renderer_id page_container/renderer|nothing;
            global tableless page_container/tableless|nothing;
            global macroless page_container/macroless|nothing;
            global renderer python: tmtool.getPageRenderer(page_renderer_id, tableless, macroless);
            global main_macro python: 'cpsskins_main_template_%s' % renderer;
            global enable_esi theme_container/esi|nothing;
            bodycolor python: page_container.color;
            pagemargin python: page_container.margin;
            global cpsskins_bodyclass python: bodycolor and 'color%s' % bodycolor or None;
            global cpsskins_bodystyle python: pagemargin and 'margin:%s' % pagemargin or None;
            global cpsskins_language python: tmtool.getCurrentLang();
            global cpsskins_url python: tmtool.getCurrentUrl();
            global boxedit boxedit|nothing;
            global shield not:tmtool/debug_mode|python:1;
            global slot_macro_path here/cpsskins_lib/macros/portalboxgroup;
            dummy python: request.set('cpsskins_language', cpsskins_language);
            dummy python: request.set('cpsskins_url', cpsskins_url);
            dummy python: request.set('cpsskins_base_url', base_url);
            dummy python: enable_esi and here.cpsskins_set_esi_header();
            global context_obj python: tmtool.getContextObj(context);
"/>
