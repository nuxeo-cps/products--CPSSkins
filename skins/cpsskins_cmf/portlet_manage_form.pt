<metal:html tal:define="global boxedit python:1;
                        tmtool here/portal_themes;
                        view_mode tmtool/getViewMode;
                        fullscreen view_mode/fullscreen|python:0;
                        panel view_mode/portlets_panel|string:site_structure;
                        selected_portlet view_mode/selected_portlet|nothing;
                        global emptybody fullscreen;
                        cpsmcat python: here.cpsskins_getlocalizer(cat='default');
                        mtool here/portal_membership;
                        checkPerm nocall:mtool/checkPermission">
  <metal:body use-macro="here/main_template/macros/master">
    <metal:head fill-slot="head_slot">
      <style type="text/css" media="all"
       tal:content="string: @import url(${here/portal_url}/cpsskins_theme_edit.css);" />
      <script type="text/javascript" src="cpsskins_pdlib.js"></script>
      <script type="text/javascript" src="cpsskins_portlet_edit.js"></script>
    </metal:head> 
    <metal:header fill-slot="header"
    tal:define="context_url python: here.absolute_url(1)">
      <tal:security condition="python: not checkPerm('Manage Portlets', here)">
        <tal:redirect define="response request/RESPONSE;
                              dummy python:response.redirect(context_url)" />
      </tal:security>
      <h1 i18n:translate="heading_portlet_manage_form">Portlet
      management</h1>
    </metal:header>

    <metal:main fill-slot="main"
     tal:define="ptltool nocall:here/portal_cpsportlets;
                 base_url python: request.get('cpsskins_base_url');
                 folder_url python: base_url + utool.getRelativeUrl(here)">

      <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/panel_selector" />
      <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/fullscreen" />
      <br clear="both" />

      <tal:block define="hidden_slots python: here.cpsskins_listHiddenSlots(theme=current_theme)" 
                 condition="python: hidden_slots and panel=='unused'">
        <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/unused_portlets_panel" />
      </tal:block>

      <tal:block condition="python: panel == 'site_structure'">
        <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/site_structure" />
      </tal:block> 

      <tal:block condition="python: panel == 'main_canvas'">
        <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/main_canvas" />
      </tal:block> 

      <tal:block condition="python: panel == 'browser'">
        <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/browser_panel" />
      </tal:block> 

    <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/contextual_menu" />

      <!-- Begin pdlib footer -->
      <div id="drag-feedback-box"></div>
        <script type="text/javascript"><!-- 
        pd_setupPage();
        // --></script>
      <!-- End pdlib footer -->

    </metal:main>
  </metal:body>
</metal:html>
