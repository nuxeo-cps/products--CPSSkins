<metal:html tal:define="global boxedit python:1;
                        view_mode here/cpsskins_getViewMode;
                        fullscreen view_mode/fullscreen|python:0;
                        panel view_mode/portlets_panel|nothing;
                        global emptybody fullscreen;
                        cpsmcat python: here.cpsskins_getlocalizer(cat='default');
                        mtool here/portal_membership;
                        checkPerm nocall:mtool/checkPermission;
                        selected_portlet request/selected_portlet|options/selected_portlet|nothing">
  <metal:body use-macro="here/main_template/macros/master">
    <metal:head fill-slot="head_slot">
      <style type="text/css" media="all"
       tal:content="string: @import url(${here/portal_url}/cpsskins_theme_edit.css);" />
      <script type="text/javascript" src="cpsskins_pdlib.js"></script>
      <script type="text/javascript" src="cpsskins_portlet_edit.js"></script>
    </metal:head> 
    <metal:header fill-slot="header"
    tal:define="context_url python: here.absolute_url(1)">
      <tal:security condition="python: not checkPerm('Manage Portlets', here)">
        <tal:redirect define="response request/RESPONSE;
                              dummy python:response.redirect(context_url)" />
      </tal:security>
      <h1 i18n:translate="heading_portlet_manage_form">Portlet
      management</h1>
    </metal:header>

    <metal:main fill-slot="main">
      <tal:block define="ptltool nocall:here/portal_cpsportlets;
                         portal_url here/portal_url">
        <form class="ViewMode" action="" method="post" 
         tal:condition="not:fullscreen"
         tal:attributes="action string:${here/absolute_url}/cpsskins_setViewMode">
          <input type="hidden" name="fullscreen" value="1" />
          <input class="Fullscreen"
           type="submit" value="_button_fullscreen_" i18n:attributes="value" />
        </form>
        <form class="ViewMode" action="" method="post"
         tal:condition="fullscreen"
         tal:attributes="action string:${here/absolute_url}/cpsskins_setViewMode">
          <input type="hidden" name="fullscreen" value="0" />
          <input class="NoFullscreen"
           type="submit" value="_button_normal_mode_" i18n:attributes="value" />
        </form>

        <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/main_canvas" />

        <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/panel_selector" />

        <tal:block define="hidden_slots python: here.cpsskins_listHiddenSlots(theme=current_theme)" 
                   condition="python: hidden_slots and panel=='unused'">
          <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/unused_portlets_panel" />
        </tal:block>

        <tal:block condition="python: panel == 'visibility'">
          <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/visibility_panel" />
        </tal:block> 

        <tal:block condition="python: panel == 'browser'">
          <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/browser_panel" />
        </tal:block> 
      </tal:block>

      <metal:block use-macro="here/cpsskins_portlet_manage_lib/macros/contextual_menu" />

      <!-- Begin pdlib footer -->
      <div id="drag-feedback-box"></div>
        <script type="text/javascript"><!-- 
        pd_setupPage();
        // --></script>
      <!-- End pdlib footer -->

    </metal:main>
  </metal:body>
</metal:html>
